<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserMapper">

	<!-- 회원정보 입력 -->
	<insert id='insertUser' parameterType="UserVO">
		INSERT INTO user(id, pwd, name, phone, addr, email, role)
		VALUES(#{id}, #{pwd}, #{name}, #{phone}, #{addr}, #{email}, 'user')
	</insert>


	<!-- 아이디 중복 체크 -->
	<select id='idCheck' parameterType="string" resultType="int">
        SELECT COUNT(*)  cnt FROM user WHERE id = #{id}
    </select>
    
    <!-- 사용자 로그인 검증 -->
	<select id='loginCheck' parameterType="UserVO" resultType="UserVO">
   		SELECT id, pwd, name, phone, addr, email, role FROM user WHERE id = #{id} AND pwd = #{pwd} AND role = #{role}
	</select>
	
	<!-- 회원 정보 수정 -->
	<update id="updateUser" parameterType="UserVO">
		UPDATE user
		SET pwd = #{pwd}, phone = #{phone}, addr = #{addr}, email = #{email}
		WHERE id = #{id}
	</update>
    
	<!-- 쇼핑카트 출력 -->
	<select id="getCartList" parameterType="hashmap" resultType="ShoppingCartVO">
		SELECT * 
	    FROM SHOPPINGCART 
	    WHERE ID = #{id}
	</select>	
	
	<!--  쇼핑카트 삭제 -->
	<delete id="cartDelete" parameterType="ShoppingCartVO">
		DELETE 
		FROM SHOPPINGCART
		WHERE SH_ID = #{sh_id}
	</delete>
	
 
    <!--  회원정보 리스트 출력 -->
	<select id="getUserList" parameterType="HashMap" resultType="UserVO">
    SELECT * FROM user 
    WHERE role = 'USER'
	 <choose>
	    <when test="searchCondition == 'name'">
	        AND name LIKE CONCAT('%', #{searchKeyword}, '%')
	    </when>
	    <when test="searchCondition == 'phone'">
	        AND phone LIKE CONCAT('%', #{searchKeyword}, '%')
	    </when>
	    <when test="searchCondition == 'id'">
	        AND id LIKE CONCAT('%', #{searchKeyword}, '%')
	    </when>
	    <when test="searchCondition == 'addr'">
	        AND addr LIKE CONCAT('%', #{searchKeyword}, '%')
	    </when>
	    <when test="searchCondition == 'email'">
	        AND email LIKE CONCAT('%', #{searchKeyword}, '%')
	    </when>
	</choose>
	LIMIT #{criteria.amount} OFFSET #{criteria.startNum}
	</select>

	
    <!-- 게시물 총 개수 -->
    <select id="getTotal" resultType="int">
        select count(*) from user WHERE role ="USER"
    </select>	
	
	<!--  공급사 추가 -->
	<insert id="insertSupply" parameterType="UserVO">	
		INSERT INTO user (id , pwd, name, phone, addr, email, role) 
		VALUES(#{id}, #{pwd}, #{name}, #{phone}, #{addr}, #{email}, 'supplier')
	</insert>
	
	<!--  공급사 리스트 출력 -->
	<select id="getSupplyList" resultType="UserVO">
		<![CDATA[
		SELECT * FROM user WHERE role = "supplier" ORDER BY id DESC;
		]]>
	</select>
	
	<!-- 관리자 페이지 사용자 정보 상세보기 -->
	<select id="userDetail" resultType="UserVO">
		<![CDATA[
		SELECT * FROM user 
		WHERE id = "${id}";
		]]>
	</select>    

	<!-- 관리자 페이지 사용자 정보 상세보기 -->
	<update id="userModify" parameterType="UserVO">
		UPDATE user 
		SET pwd ='${pwd}', name ='${name}', phone ='${phone}', addr='${addr}', email='${email}'
		WHERE id = #{id}
	</update>
	
</mapper>